# ECG MQTT Service

The application described below includes a foreground service that receives an __ECG__ signal from the same application, transmitted via an __MQTT bridge__. The builtin __MQTT client-server__ receives the data and sends it to the application for playback. The application can also act as an __ECG signal generator__. In this case, the generated signal is sent to the network via the __MQTT__ __publish__ operation.

Should be mentioned that the application was created gradually and below are listed the intermediate projects that became its basis.

* https://github.com/mk590901/ECG-Server
* https://github.com/mk590901/ECG-Pseudo-Service
* https://github.com/mk590901/ECG-FB-Service
* https://github.com/mk590901/flutter_fb_task

## Inside Application



## Application Features

> __Action__ button adds __ECG client__ to app. With the help of swape client can be deleted. There are two types of deletion:
* GUI image of client is deleted: swipe from left to right. In this case, the pseudo client continues to generate a signal and automatically returns to the list.
* Brutal pseudo client delete from the application: swipe from right to left.
>__Stop button__ deletes GUI images of clients.

> A significant change is related to the creation of a __widget__ for displaying the ECG signal. __Widget__ is created not in advance, before the signal display process startsbut after receiving the data, and uses the attributes of this data.

> From the GUI point of view, the application is identical to the ECG Pseudo Service application in the repository https://github.com/mk590901/ECG-Pseudo-Service, but from the architectural point of view there are differences:

* In current app __ECG__ signal sources, objects of the SimulatorWrapper, type are located in the container, in the service in the __ServiceTaskHandler__ class. Singleton __ServiceAdapter__ contains a clone of this container in application. Its elements hold data of the corresponding __SimulatorWrapper__ objects generated by the service in the __onRepeatEvent__ callback. Data is transferred to the application by the command

```dart
sendPort?.send({
  'response': 'sync',
  'value': {'id': wrapper.id(), 'length': wrapper.length(), 'raw_data': rawData, }, ,
});
```

This command updates the container in the singleton __ServiceAdapter__ in the application's listener ___dataSubscription__ in the __AppBloc__ class constructor. The issue of adding the corresponding item to the list of GUI objects also resolves in this place.
 
## Movie

The movie below shows the application's operation: can add an __ECG__ signal source, remove it from the list temporarily or permanently, and also close the application without deleting the service, and re-open the application via the __notification widget__ and continue working.

https://github.com/user-attachments/assets/bf1ee9d3-0cd7-453a-bc3f-90ae3a499e4f




